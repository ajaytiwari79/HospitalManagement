// questionnaire template script gdpr
db.getCollection('questionnaire_template').updateMany({'deleted':false,'defaultAssetTemplate':{ $exists: false}},{$set:{"defaultAssetTemplate":false}})

match(e:UnitPosition) where e.deleted=true
detach delete e

match(e:UnitPosition)
with e,datetime({ epochMillis: e.startDateMillis }) as startDateTime
set e.startDate=toString(date(startDateTime))
remove  e.startDateMillis
return e

match(e:UnitPosition) where exists(e.endDateMillis)
with e,datetime({ epochMillis: e.endDateMillis }) as endDateTime
set e.endDate= toString(date(endDateTime))
remove e.endDateMillis
return e

MATCH (n:UnitPosition) where NOT (n)-[:HAS_POSITION_LINES]-(:UnitPositionLine)
with collect (n) as allL
forEach(n IN (allL)|
merge(n)-[:HAS_POSITION_LINES]-(npl:UnitPositionLine)
  set npl.avgDailyWorkingHours=n.avgDailyWorkingHours
  set npl.workingDaysInWeek= n.workingDaysInWeek
  set npl.hourlyWages= n.hourlyWages
  set npl.totalWeeklyMinutes= n.totalWeeklyMinutes
  set npl.startDate= n.startDate
  set npl.endDate= n.endDate
  set npl.fullTimeWeeklyMinutes= n.fullTimeWeeklyMinutes
);

MATCH (n:UnitPosition)-[:HAS_POSITION_LINES]->(pl:UnitPositionLine)
MATCH(n)-[rel:HAS_SENIORITY_LEVEL]->(sl:SeniorityLevel)
merge(pl)-[:HAS_SENIORITY_LEVEL]->(sl)
detach delete rel