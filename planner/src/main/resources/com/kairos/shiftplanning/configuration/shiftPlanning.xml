<?xml version="1.0" encoding="UTF-8"?>
<solver>
  <!--<environmentMode>FULL_ASSERT</environmentMode>-->
  <solutionClass>com.kairos.shiftplanning.solution.ShiftPlanningSolution</solutionClass>
  <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
  <entityClass>com.kairos.shiftplanning.domain.staffing_level.SkillLineInterval</entityClass>
  <entityClass>com.kairos.shiftplanning.domain.shift.ShiftImp</entityClass>
    <!--<entityClass>com.kairos.shiftplanning.domain.staff.IndirectActivity</entityClass>-->
  <!--
  Intervals on assigned back to null will not reduce shift length if they are in mid of shift and hence causing score corruption, which is fine
  <environmentMode>FULL_ASSERT</environmentMode>-->
    <!--<environmentMode>FAST_ASSERT</environmentMode>-->
    <!--<environmentMode>FULL_ASSERT</environmentMode>-->
  <scoreDirectorFactory>
      <scoreDrl>com/kairos/shiftplanning/rules/shiftplanning_activityLine.drl</scoreDrl>
      <scoreDrl>com/kairos/shiftplanning/rules/wtaConstraintsRule.drl</scoreDrl>
      <!--<scoreDrl>com/kairos/shiftplanning/rules/ctaConstraintsRule.drl</scoreDrl>-->
      <scoreDrl>com/kairos/shiftplanning/rules/activityConstraintsRule.drl</scoreDrl>
      <initializingScoreTrend>ONLY_DOWN</initializingScoreTrend>
  </scoreDirectorFactory>
    <constructionHeuristic>
        <queuedEntityPlacer>
            <entitySelector id="activityLineIntervalSelector">
                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
            </entitySelector>
            <changeMoveSelector>
                <entitySelector mimicSelectorRef="activityLineIntervalSelector"/>
                <valueSelector>
                    <variableName>shift</variableName>
                </valueSelector>
            </changeMoveSelector>
        </queuedEntityPlacer>
    </constructionHeuristic>
    <constructionHeuristic>
        <queuedEntityPlacer>
            <entitySelector id="skillLineIntervalSelector">
                <entityClass>com.kairos.shiftplanning.domain.staffing_level.SkillLineInterval</entityClass>
            </entitySelector>
            <changeMoveSelector>
                <entitySelector mimicSelectorRef="skillLineIntervalSelector"/>
                <valueSelector>
                    <variableName>shift</variableName>
                </valueSelector>
            </changeMoveSelector>
        </queuedEntityPlacer>
    </constructionHeuristic>
    <!--<constructionHeuristic>
        <queuedEntityPlacer>
            <entitySelector id="indirectActivitySelector">
                <entityClass>com.kairos.shiftplanning.domain.staff.IndirectActivity</entityClass>
            </entitySelector>
            <changeMoveSelector>
                <entitySelector mimicSelectorRef="indirectActivitySelector"/>
                <valueSelector>
                    <variableName>startTime</variableName>
                </valueSelector>
            </changeMoveSelector>
        </queuedEntityPlacer>
    </constructionHeuristic>-->
    <!--<changeMoveSelector>
                <entitySelector>
                    <entityClass>com.kairos.shiftplanning.domain.staff.IndirectActivity</entityClass>
                </entitySelector>
                <valueSelector>
                    <variableName>startTime</variableName>
                </valueSelector>
            </changeMoveSelector>-->
    <localSearch>
    <unionMoveSelector>
        <moveIteratorFactory>
            <moveIteratorFactoryClass>com.kairos.shiftplanning.move.ActivityLineIntervalPillarMoveIteratorFactory</moveIteratorFactoryClass>
        </moveIteratorFactory>
        <moveIteratorFactory>
            <moveIteratorFactoryClass>com.kairos.shiftplanning.move.ActivityLineIntervalChangeMoveIteratorFactory</moveIteratorFactoryClass>
        </moveIteratorFactory>
        <swapMoveSelector>
            <entitySelector>
                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
            </entitySelector>
            <selectedCountLimit>200</selectedCountLimit>
            <secondaryEntitySelector>
                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
            </secondaryEntitySelector>
            <variableNameInclude>shift</variableNameInclude>
            <filterClass>com.kairos.shiftplanning.move.ActivityLineIntervalSwapMoveFilter</filterClass>
        </swapMoveSelector>
    </unionMoveSelector>
        <acceptor>
            <lateAcceptanceSize>100</lateAcceptanceSize>
        </acceptor>
        <forager>
            <acceptedCountLimit>1</acceptedCountLimit>
        </forager>
        <termination>
            <unimprovedSecondsSpentLimit>1000</unimprovedSecondsSpentLimit>
        </termination>
    </localSearch>

   <!-- <localSearch>
        <unionMoveSelector>
            &lt;!&ndash;<selectionOrder>ORIGINAL</selectionOrder>&ndash;&gt;
            <moveIteratorFactory>
                <moveIteratorFactoryClass>com.kairos.shiftplanning.domain.move.ActivityLineIntervalChangeMoveIteratorFactoryactory</moveIteratorFactoryClass>
            </moveIteratorFactory>

        </unionMoveSelector>
        <acceptor>
            <lateAcceptanceSize>800</lateAcceptanceSize>
        </acceptor>
        <forager>
            &lt;!&ndash; no matter what your acceptedCount of forager is, it'll only pick one move per step and if it's more than 1 , it'll pick 1 randomly.. SO freaking useful check AcceptedForager.pickMove()
            &ndash;&gt;
            <acceptedCountLimit>1</acceptedCountLimit>
        </forager>
        <termination>
            <unimprovedSecondsSpentLimit>600</unimprovedSecondsSpentLimit>
        </termination>
    </localSearch>-->
    <!--<localSearch>
    <unionMoveSelector>
       &lt;!&ndash; <changeMoveSelector>
            <entitySelector>
                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
            </entitySelector>
                <selectedCountLimit>1000</selectedCountLimit>
            <valueSelector>
                <variableName>shift</variableName>
            </valueSelector>
            <filterClass>ActivityLineIntervalChangeMoveFilter</filterClass>
        </changeMoveSelector>&ndash;&gt;
        <swapMoveSelector>
            <entitySelector>
                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
            </entitySelector>
            <selectedCountLimit>1000</selectedCountLimit>
            <secondaryEntitySelector>
                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
            </secondaryEntitySelector>
            <variableNameInclude>shift</variableNameInclude>
            <filterClass>ActivityLineIntervalSwapMoveFilter</filterClass>
        </swapMoveSelector>
    </unionMoveSelector>
        <acceptor>
            <lateAcceptanceSize>400</lateAcceptanceSize>
        </acceptor>
        <termination>
            <unimprovedSecondsSpentLimit>10</unimprovedSecondsSpentLimit>
        </termination>
    </localSearch>-->
    <termination>
        <secondsSpentLimit>4000</secondsSpentLimit>
    </termination>
    <!--<pillarChangeMoveSelector>
                        <pillarSelector>
                            <entitySelector>
                                <entityClass>com.kairos.shiftplanning.domain.activity.ActivityLineInterval</entityClass>
                                &lt;!&ndash;<cacheType>STEP</cacheType>&ndash;&gt;
                            </entitySelector>
                            &lt;!&ndash;well, if you use filter, you cant use subpillar and without subpillar pillar size is max which makes no sense.
                             if you dont use filter, it'll assign a interval from start of week and a interval at end of week.. making shift goes days and days.&ndash;&gt;
                            <subPillarEnabled>false</subPillarEnabled>
                            &lt;!&ndash;<subPillarEnabled>true</subPillarEnabled>
                            <minimumSubPillarSize>1</minimumSubPillarSize>
                            <maximumSubPillarSize>40</maximumSubPillarSize>&ndash;&gt;
                        </pillarSelector>
                        <selectedCountLimit>1000</selectedCountLimit>
                        <valueSelector variableName="shift">
                        </valueSelector>
                        <filterClass>ActivityLineIntervalPillarMoveFilter</filterClass>
                    </pillarChangeMoveSelector>-->
</solver>
